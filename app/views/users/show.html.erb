<%= Gon::Base.render_data %>

<div id="form">
  <%= form_with model: Overtime.new do |form| %>

    <div class="input-group">
      <div class="input-group-prepend">
        <span class="input-group-text">日付</span>
      </div>
      <%= form.date_field :date, class: 'form-control', id: "new-calendar" %>
    </div>

    <div class="input-group mt-3 input-time">
      <div class="input-group-prepend">
        <span class="input-group-text">開始時刻</span>
      </div>
      <%= form.time_select :work_start_time, class: 'form-control', required: true %>
    </div>

    <div class="input-group mt-3 input-time">
      <div class="input-group-prepend">
        <span class="input-group-text">終了時刻</span>
      </div>
      <%= form.time_select :work_end_time, class: 'form-control', required: true %>
    </div>

    <div class="input-group mt-3">
      <div class="input-group-prepend">
        <span class="input-group-text">残業時間</span>
      </div>
      <%= form.text_field :work_time, class: 'form-control', id: "work-time", readonly: true, required: true %>
    </div>

    <div class="form-group mt-3">
      <%= form.submit '新規登録', class: 'btn btn-primary btn-block' %>
    </div>
  <% end %>
</div>

<div class="period-form mt-5">
  <%= form_with scope: :chart_period do |form| %>
    <div class="row">
      <div class="input-group-prepend col-3">
        <span class="input-group-text">始期年月</span>
        <%= form.date_select(:beginning, discard_day: true, use_month_numbers: true, start_year: Time.now.year - 2, end_year: Time.now.year, default: Date.today - 5.month) %>
      </div>
      <div class="input-group-prepend col-3">
        <span class="input-group-text">終期年月</span>
        <%= form.date_select(:end, discard_day: true, use_month_numbers: true, start_year: Time.now.year - 2, end_year: Time.now.year) %>
      </div>
      <input type="button" value="表示" id="chart-period-button" class="btn btn-primary col-1">
    </div>
  <% end %>
</div>

<canvas id="show-chart" class="chart mt-5 mb-5"></canvas>

<p>今月の残業</p>
<table class="table table-hover" id="show-table">
  <thead>
    <tr>
      <th class="text-center">日付</th>
      <th class="text-center">曜日</th>
      <th class="text-center">開始時刻</th>
      <th class="text-center">終了時刻</th>
      <th class="text-center">時間数</th>
    </tr>
  </thead>
  <tbody>
    <% @overtimes.each do |overtime| %>
      <tr>
        <td class="text-center"><%= extract_date(overtime.date) %></td>
        <td class="text-center day"><%= extract_day(overtime.date) %></td>
        <td class="text-center"><%= extract_time(overtime.work_start_time) %></td>
        <td class="text-center"><%= extract_time(overtime.work_end_time) %></td>
        <td class="text-center"><%= convert_to_hour_and_minute(overtime.work_time_minute) %></td>
      </tr>
    <% end %>
    <tr>
      <td class="text-center"></td>
      <td class="text-center"></td>
      <td class="text-center"></td>
      <td class="text-right">合計</td>
      <td class="text-center"><%= convert_to_hour_and_minute(@overtimes.sum(:work_time_minute)) %></td>
    </tr>
  </tbody>
</table>
